<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏ ‚Äî Natafit</title>
  <link rel="stylesheet" href="css/styles.css" />
  <style>
    * {
      transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, transform 0.2s ease;
    }
    
    .admin-nav {
      background: var(--card);
      padding: 16px;
      border-radius: var(--radius);
      margin-bottom: 24px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    .admin-nav a {
      padding: 8px 16px;
      border-radius: var(--radius);
      text-decoration: none;
      color: var(--text);
      border: 2px solid var(--accent2);
    }
    
    .admin-nav a.active {
      border-color: var(--accent1);
      background: var(--accent1);
      color: white;
    }
    
    .clients-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 24px;
    }
    
    .client-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      position: relative;
      cursor: pointer;
    }
    
    .client-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }
    
    .client-card h3 {
      margin-bottom: 12px;
      color: var(--accent1);
    }
    
    .client-info {
      font-size: 14px;
      color: var(--text);
      margin: 8px 0;
    }
    
    .client-actions {
      display: flex;
      gap: 8px;
      margin-top: 16px;
    }
    
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    .modal.visible {
      display: flex;
    }
    
    .modal-content {
      background: var(--card);
      padding: 32px;
      border-radius: var(--radius);
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--text);
      font-weight: 500;
    }
    
    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid var(--accent2);
      border-radius: var(--radius);
      background: var(--bg);
      color: var(--text);
      font-size: 16px;
    }
    
    .form-group input:focus,
    .form-group textarea:focus {
      border-color: var(--accent1);
      outline: none;
    }
    
    .modal-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 24px;
    }
    
    .search-box {
      margin-bottom: 24px;
    }
    
    .search-box input {
      width: 100%;
      padding: 12px;
      border: 2px solid var(--accent2);
      border-radius: var(--radius);
      background: var(--card);
      color: var(--text);
      font-size: 16px;
    }
  </style>
</head>
<body>
  <header class="container header">
    <a href="index.html" class="logo"><img src="assets/logo.svg" alt="Natafit logo"/></a>
    <button class="hamburger" id="hamburger" aria-label="–ú–µ–Ω—é">
      <span></span>
      <span></span>
      <span></span>
    </button>
    <nav class="nav" id="nav">
      <div class="controls">
        <button id="theme-toggle" class="theme-toggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
          <span class="theme-toggle-text" data-translate="theme.dark">–¢—ë–º–Ω–∞—è</span>
        </button>
        <button id="logoutBtn" class="btn btn-secondary">–í—ã–π—Ç–∏</button>
      </div>
    </nav>
  </header>

  <main class="container">
    <nav class="admin-nav">
      <a href="admin-schedule.html">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</a>
      <a href="admin-clients.html" class="active">–ö–ª–∏–µ–Ω—Ç—ã</a>
    </nav>

    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;flex-wrap:wrap;gap:16px">
      <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏</h1>
      <button class="btn btn-primary" id="addClientBtn">+ –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>
    </div>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:24px">
      <div style="background:var(--card);padding:20px;border-radius:var(--radius);border-left:4px solid var(--accent1)">
        <div style="font-size:14px;color:var(--muted);margin-bottom:8px">–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
        <div style="font-size:32px;font-weight:bold;color:var(--accent1)" id="totalClients">0</div>
      </div>
      <div style="background:var(--card);padding:20px;border-radius:var(--radius);border-left:4px solid var(--accent2)">
        <div style="font-size:14px;color:var(--muted);margin-bottom:8px">–ù–æ–≤—ã—Ö –∑–∞ –º–µ—Å—è—Ü</div>
        <div style="font-size:32px;font-weight:bold;color:var(--accent2)" id="newClients">0</div>
      </div>
    </div>
    
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, —Ç–µ–ª–µ—Ñ–æ–Ω—É –∏–ª–∏ email...">
    </div>

    <div class="clients-grid" id="clientsGrid">
      <!-- –ö–ª–∏–µ–Ω—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
    </div>
  </main>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ -->
  <div class="modal" id="clientModal">
    <div class="modal-content">
      <h2 id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</h2>
      <form id="clientForm">
        <div class="form-group">
          <label for="clientName">–ò–º—è *</label>
          <input type="text" id="clientName" required>
        </div>
        <div class="form-group">
          <label for="clientPhone">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
          <input type="tel" id="clientPhone" required placeholder="+49 123 456789">
        </div>
        <div class="form-group">
          <label for="clientEmail">Email</label>
          <input type="email" id="clientEmail" placeholder="client@example.com">
        </div>
        <div class="form-group">
          <label for="clientGoal">–¶–µ–ª—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</label>
          <textarea id="clientGoal" rows="2" placeholder="–ü–æ—Ö—É–¥–µ–Ω–∏–µ, –Ω–∞–±–æ—Ä –º–∞—Å—Å—ã, –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —Ñ–æ—Ä–º—ã..."></textarea>
        </div>
        <div class="form-group">
          <label for="clientNotes">–ó–∞–º–µ—Ç–∫–∏</label>
          <textarea id="clientNotes" rows="3" placeholder="–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –∑–¥–æ—Ä–æ–≤—å—é, –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è..."></textarea>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
          <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </form>
    </div>
  </div>

  <footer class="container footer">
    <div class="footer-content">
      <div class="footer-left">
        <div>&copy; Natafit ‚Äî –≤—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã</div>
        <div class="small">+49 151 29614047</div>
      </div>
    </div>
  </footer>

  <script src="js/theme.js"></script>
  <script>
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    function checkAuth() {
      const user = sessionStorage.getItem('authUser');
      if (!user) {
        window.location.href = 'admin-login.html';
      }
    }

    let clients = JSON.parse(localStorage.getItem('clients')) || [];
    let editingClientId = null;

    function saveClients() {
      localStorage.setItem('clients', JSON.stringify(clients));
    }

    function openAddModal() {
      editingClientId = null;
      document.getElementById('modalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞';
      document.getElementById('clientForm').reset();
      document.getElementById('clientModal').classList.add('visible');
    }

    function openEditModal(clientId) {
      editingClientId = clientId;
      const client = clients.find(c => c.id === clientId);
      if (!client) return;

      document.getElementById('modalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞';
      document.getElementById('clientName').value = client.name;
      document.getElementById('clientPhone').value = client.phone;
      document.getElementById('clientEmail').value = client.email || '';
      document.getElementById('clientGoal').value = client.goal || '';
      document.getElementById('clientNotes').value = client.notes || '';
      document.getElementById('clientModal').classList.add('visible');
    }

    function closeModal() {
      document.getElementById('clientModal').classList.remove('visible');
      document.getElementById('clientForm').reset();
      editingClientId = null;
    }

    function deleteClient(clientId) {
      if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞?')) {
        clients = clients.filter(c => c.id !== clientId);
        saveClients();
        renderClients();
      }
    }

    function renderClients(filter = '') {
      const grid = document.getElementById('clientsGrid');
      const filteredClients = clients.filter(client => {
        const searchText = filter.toLowerCase();
        return client.name.toLowerCase().includes(searchText) ||
               client.phone.toLowerCase().includes(searchText) ||
               (client.email && client.email.toLowerCase().includes(searchText));
      });

      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
      const now = new Date();
      const monthAgo = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());
      const newThisMonth = clients.filter(c => new Date(c.createdAt) > monthAgo).length;
      
      document.getElementById('totalClients').textContent = clients.length;
      document.getElementById('newClients').textContent = newThisMonth;

      if (filteredClients.length === 0) {
        grid.innerHTML = '<p style="grid-column:1/-1;text-align:center;color:var(--muted)">–ù–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤</p>';
        return;
      }

      grid.innerHTML = filteredClients.map(client => `
        <div class="client-card">
          <h3>${client.name}</h3>
          <div class="client-info">
            <strong>üìû –¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${client.phone}
          </div>
          ${client.email ? `
            <div class="client-info">
              <strong>üìß Email:</strong> ${client.email}
            </div>
          ` : ''}
          ${client.goal ? `
            <div class="client-info">
              <strong>üéØ –¶–µ–ª—å:</strong> ${client.goal}
            </div>
          ` : ''}
          ${client.notes ? `
            <div class="client-info">
              <strong>üìù –ó–∞–º–µ—Ç–∫–∏:</strong> ${client.notes}
            </div>
          ` : ''}
          <div class="client-info" style="color:var(--muted);font-size:12px;margin-top:12px">
            –î–æ–±–∞–≤–ª–µ–Ω: ${new Date(client.createdAt).toLocaleDateString('ru-RU')}
          </div>
          <div class="client-actions">
            <button class="btn btn-secondary" style="flex:1" onclick="openEditModal(${client.id})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn btn-secondary" onclick="deleteClient(${client.id})">–£–¥–∞–ª–∏—Ç—å</button>
          </div>
        </div>
      `).join('');
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
    document.getElementById('clientForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const clientData = {
        name: document.getElementById('clientName').value,
        phone: document.getElementById('clientPhone').value,
        email: document.getElementById('clientEmail').value,
        goal: document.getElementById('clientGoal').value,
        notes: document.getElementById('clientNotes').value
      };

      if (editingClientId) {
        const index = clients.findIndex(c => c.id === editingClientId);
        clients[index] = { ...clients[index], ...clientData };
      } else {
        clients.push({
          id: Date.now(),
          ...clientData,
          createdAt: new Date().toISOString()
        });
      }

      saveClients();
      renderClients();
      closeModal();
    });

    // –ü–æ–∏—Å–∫
    document.getElementById('searchInput').addEventListener('input', function(e) {
      renderClients(e.target.value);
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    document.getElementById('addClientBtn').addEventListener('click', openAddModal);
    document.getElementById('logoutBtn').addEventListener('click', () => {
      sessionStorage.removeItem('authUser');
      window.location.href = 'admin-login.html';
    });

    // Mobile menu
    const hamburger = document.getElementById('hamburger');
    const nav = document.getElementById('nav');
    
    hamburger?.addEventListener('click', () => {
      hamburger.classList.toggle('active');
      nav.classList.toggle('active');
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    checkAuth();
    renderClients();
  </script>
</body>
</html>
